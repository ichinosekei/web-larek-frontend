# Проектная работа "Веб-ларек"

## Этот проект представляет собой одностраничное приложение для онлайн-магазина, разработанное с использованием TypeScript.

### Он позволяет пользователям:

* Просматривать список товаров.
* Добавлять товары в корзину.
* Оформлять заказы с валидацией данных.
* Получать подтверждение успешного заказа.
  Приложение построено на основе компонентного подхода, а взаимодействие между модулями реализовано через событийную
  систему.

Стек: HTML, SCSS, TS, Webpack

## Функциональные возможности

### Работа с товарами

- Получение данных о товарах с сервера.
- Динамическое отображение списка товаров.
- Просмотр детальной информации о товаре в модальном окне.

### Работа с корзиной

- Добавление товаров в корзину.
- Удаление товаров из корзины.
- Подсчёт общей стоимости товаров и их количества.

### Оформление заказа

- Ввод адреса и способа оплаты.
- Валидация полей ввода.
- Отображение ошибок для незаполненных или некорректных полей.

### Подтверждение заказа

- Отправка данных на сервер.
- Отображение модального окна с информацией о подтверждении заказа.

## Структура проекта

Проект организован по принципам модульности. Каждый модуль отвечает за конкретную часть функциональности.

- src/components:
  base — базовые модули (например, управление событиями EventEmitter).
  Model — работа с данными, API и бизнес-логика (например, модели корзины и формы заказа).
  view — компоненты для отображения интерфейса (например, карточки товаров, модальные окна).
- src/utils — вспомогательные функции и константы.
- src/scss — стили приложения.
- src/types — типы и интерфейсы TypeScript для строгой типизации.

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды\
Перейдите в директорию проекта:

```bash
cd web-larek-frontend
```

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

# Компоненты данных

Компоненты данных отвечают за хранение, обработку и управление данными, которые используются в приложении. Эти модули
работают с API, манипулируют данными в приложении и генерируют события для передачи данных другим компонентам.

## 1.1 ShopApi

**Роль:** Обеспечивает взаимодействие с сервером.

### Функции:

- **`fetchListProductCard()`** — выполняет запрос на сервер для получения списка товаров. Формирует массив объектов с
  товарами, добавляя базовый URL для изображений.
- **`submitOrder(order: IOrder)`** — отправляет данные заказа на сервер и возвращает результат.

### Пример:

```typescript
const apiModel = new ShopApi(CDN_URL, API_URL);
apiModel.getListProductCard().then(data => console.log(data));
```

## 1.2 ProductDataModel

**Роль:** Управляет данными о продуктах.

#### Функции:

- Хранит список товаров в поле **`productList`**.
- Обеспечивает выбор текущего товара для отображения в модальном окне через метод **`setProductPreview(product)`**.
- Генерирует событие **`productCards:receive`** после получения списка товаров.

#### Пример:

```typescript
dataModel.setProductPreview(selectedProduct);
events.on('productCards:receive', () => {
    console.log(dataModel.productList);
});
```

### 1.3 CartModel

**Роль:** Управляет состоянием корзины.

#### Функции:

- **`addProductsToCart`** — добавляет товары в корзину.
- **`removeProductsFromCart`** — удаляет товары из корзины.
- **`getProductsCount`** — подсчитывает общее количество товаров.
- **`getTotalPrice`** — подсчитывает общую стоимость товаров.
- **`isProductsInCart`** — проверяет наличие товара в корзине.
- **`clearCartProducts`** — очищает корзину

#### Пример:

```typescript
basketModel.addProductsToCart(selectedProduct);
console.log(basketModel.getProductsCount());
```

## 1.4 OrderFormModel

**Роль:** Управляет данными, вводимыми в форму заказа.

#### Функции:

- Устанавливается адрес **`setDeliveryAddress`**, способ оплаты **`setPaymentMethod`**, телефон и email *
  *`setContactData`** .
- Валидирует данные через методы **`validateOrder`** и **`validateContacts`**.
- Генерирует payload для отправки на сервер через **`generateOrderPayload()`**.

#### Пример:

```typescript
formModel.setDeliveryAddress('address', 'ул. Московская, 1');
```

## 2. Компоненты отображения

Компоненты отображения отвечают за визуализацию данных, предоставляемых моделями, и обработку взаимодействий
пользователя. Они включают в себя карточки товаров, корзину, формы и модальные окна. Ниже представлено подробное
описание каждого компонента:

---

## 2.1 ProductCard

**Роль:** Отображение информации о товаре в виде карточки.

### Основной функционал:

- Отображение названия, категории, цены и изображения товара.
- Стилизованное отображение категории товара.

### Ключевые методы:

- **`render(data: IProduct):`**
    - Принимает объект товара `data`.
    - Динамически обновляет DOM-элементы карточки (название, категория, цена, изображение).
    - Применяет стили для категории товара, используя соответствующий CSS-класс.

### Пример использования:

```typescript
const card = new ProductCard(template, events, {onClick: () => console.log('Card clicked')});
document.body.append(card.render(productData));
```

### 2.2 ProductCardPreview

**Роль:** Расширяет `ProductCard`, добавляя интерактивные элементы.

#### Основной функционал:

- Добавление кнопки "Купить".
- Логика блокировки кнопки, если товар уже добавлен в корзину.
- Отображение описания товара.

#### Ключевые методы:

- **`determineActionButtonState(data: IProduct):`**
    - Устанавливает текст и состояние кнопки:
        - "Не продается", если цена товара равна `null`.
        - "В корзине", если товар уже добавлен.
        - "Купить", если товар доступен для покупки.
- **`render(data: IProduct):`**
    - Включает отображение дополнительных элементов (например, описания).
    - Использует состояние кнопки, установленное через `determineActionButtonState`.

#### Пример использования:

```typescript
const cardPreview = new ProductCardPreview(template, events, cartModel);
modal.contentElement = cardPreview.render(productData);
modal.open();
```

## 2.3 Cart

**Роль:** Управляет визуализацией корзины.

#### Основной функционал:

- Отображает список товаров, добавленных в корзину.
- Показывает общее количество товаров и их стоимость.

#### Ключевые методы:

- **`updateHeaderCartCounter(count: number):`**
    - Обновляет иконку корзины, показывая текущее количество товаров.
- **`updateTotalPrice(total: number):`**
    - Обновляет отображение общей стоимости товаров.
- **`renderCart():`**
    - Отображает корзину с текущими товарами.
    - Включает кнопку для удаления товара.

#### Пример использования:

```typescript
const cart = new Cart(template, events);
document.body.append(cart.renderCart());
```

## 2.4 CartItem

**Роль:** Отображает отдельный товар в корзине.

#### Основной функционал:

- Показывает название, цену и индекс товара в корзине.
- Включает кнопку для удаления товара.

#### Ключевые методы:

- **`render(data: IProduct, index: number):`**
    - Обновляет DOM-элементы с названием, ценой и индексом товара.
    - Привязывает обработчик события для кнопки удаления.

#### Пример использования:

```typescript
const cartItem = new CartItem(template, events, {onClick: () => console.log('Item removed')});
document.body.append(cartItem.render(productData, 1));
```

## 2.5 OrderForm

**Роль:** Отображает форму для оформления заказа.

#### Основной функционал:

- Позволяет выбрать способ оплаты.
- Проверяет, заполнены ли обязательные поля (например, адрес доставки).

#### Ключевые методы:

- **`set selectedPaymentMethod(paymentMethod: string):`**
    - Устанавливает визуальное выделение для выбранного метода оплаты.
- **`render():`**
    - Возвращает HTML-элемент формы для отображения.

#### Пример использования:

```typescript
const orderForm = new OrderForm(template, events);
document.body.append(orderForm.render());
```

## 2.6 ContactForm

**Роль:** отвечает за управление формой для ввода контактной информации пользователя и обработку взаимодействий с этой
формой.

#### Основной функционал:

- позволяет отслеживать изменения данных в полях
- валидировать форму и обрабатывать её отправку

#### Ключевые методы:

- **`render():`**
    - Возвращает HTML-элемент формы для отображения.

#### Пример использования:

```typescript
const contactForm = new ContactForm(template, events);
document.body.append(contactForm.render());
```

## 2.7 SuccessMessage

**Роль:** Отображает сообщение об успешном заказе.

#### Основной функционал:

- Показывает общую стоимость заказа.
- Включает кнопку для закрытия сообщения.

#### Ключевые методы:

- **`render(total: number):`**
    - Отображает стоимость заказа.

#### Пример использования:

```typescript
const successMessage = new SuccessMessage(template, events);
modal.contentElement = successMessage.render(totalPrice);
modal.open();
```

## 2.8 ModalWindow

**Роль:** Универсальный компонент для управления модальными окнами.

#### Основной функционал:

- Устанавливает и отображает контент модального окна.
- Управляет открытием и закрытием окна.
- Блокирует основной контент страницы, предотвращая прокрутку.

#### Ключевые методы:

- **`set contentElement(value: HTMLElement):`**
    - Устанавливает содержимое модального окна.
- **`open():`**
    - Открывает модальное окно, добавляя соответствующий класс CSS.
- **`close():`**
    - Закрывает модальное окно и очищает его содержимое.
- **`set isLocked(value: boolean):`**
    - Включает или отключает блокировку основного контента страницы.

#### Пример использования:

```typescript
modal.contentElement = productCardPreview.render(productData);
modal.open();
```

## 3 Класс Api имеет следующие свойства и методы.

**Роль:** API — это ключевой компонент проекта, который управляет взаимодействием с сервером, предоставляя интерфейс для
получения и отправки данных.

#### Основной функционал:

- `handleResponse(response: Response): Promise<object>` - обработчик ответа сервера.
- `get(uri: string)` - принимает изменяющеюся часть url-адреса, возвращает ответ от сервера.
- `post(uri: string, data: object, method: ApiPostMethods = 'POST')` - принимает изменяющеюся часть url-адреса,
  принимает данные в виде объекта для отправки на сервер, type ApiPostMethods = 'POST' | 'PUT' | 'DELETE'.

## 4 Класс EventEmitter - брокер событий, implements от IEvents и имеет следующие методы.

**Роль:** Класс EventEmitter реализует паттерн «Observer» и обеспечивает работу событий, его методы позволяют
устанавливать и снимать слушатели событий, вызвать слушатели при возникновении события.

Методы:

- `on` - для подписки на событие.
- `off` - для отписки от события.
- `emit` - уведомления подписчиков о наступлении события соответственно.
- `onAll` - для подписки на все события.
- `offAll` - сброса всех подписчиков.
- `trigger` - генерирует заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика
  события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса
  `EventEmitter`.

### Основные сущности и их интерфейсы

#### Товары

``` typescript
export interface IProduct {
id: string;           // Уникальный идентификатор
title: string;        // Название
description: string;  // Описание
image: string;        // URL изображения
category: string;     // Категория
price: number | null; // Цена или null (если цена отсутствует)
}

```

#### Прочее

```typescript
// Интерфейс для описания действий (например, клика на элемент)
export interface IAction {
    onClick: (event: MouseEvent) => void; // Обработчик клика на элемент
}

// Тип для ошибок формы. Позволяет ассоциировать каждое поле формы с текстом ошибки
export type FormErrors = Partial<Record<keyof IOrder, string>>;
```

#### Заказы

```typescript
// Интерфейс для описания заказа
export interface IOrder extends IOrderForm {
    items: string[]; // Массив идентификаторов товаров, включённых в заказ
}

// Интерфейс для описания результата выполнения заказа
export interface IOrderResult {
    id: string; // Идентификатор заказа
    total: number; // Общая стоимость заказа
}

export interface IOrderForm {
    payment?: string;
    address?: string;
    phone?: string;
    email?: string;
    total?: string | number;
}
```
